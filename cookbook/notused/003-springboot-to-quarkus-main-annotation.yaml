- category: mandatory
  customVariables: []
  description: SpringBoot to Quarkus
  effort: 1
  labels:
    - konveyor.io/source=springboot
    - konveyor.io/target=quarkus
  links: []
  message: "SpringBoot to Quarkus."
  ruleID: 003-springboot-to-quarkusmain-annotation
  when:
    #java.referenced:
    #  location: ANNOTATION
    #  pattern: org.springframework.boot.autoconfigure.SpringBootApplication
    condition: java.annotation is 'org.springframework.boot.autoconfigure.SpringBootApplication'
  order: 3
  instructions:
    ai:
      #- promptMessage: "Can you now remove the @SpringBootApplication from the java file which contains it. Next add to the same java class the @QuarkusMain annotation. The AppApplication should not implement QuarkusApplication."
      - tasks:
          - "Can you remove the @SpringBootApplication from the java file com.todo.app.AppApplication.java."
          - "Next add to the same java class the @QuarkusMain annotation."
          - "The AppApplication should not implement QuarkusApplication."
          - "Pass as first argument: TodoApplication.class to the Quarkus.run() method"
    manual:
      - todo: "See openrewrite instructions"
    openrewrite:
      - name: SpringBoot to Quarkus
        description: Replace the SpringBootApplication annotation with QuarkusMain, Remove the statement SpringApplication.run(), Add the io.quarkus.runtime.Quarkus.run() method within the main void method and pass the String[] args as parameter"
        preconditions:
          - name: org.openrewrite.java.dependencies.search.ModuleHasDependency
            groupIdPattern: org.springframework.boot
            artifactIdPattern: spring-boot
            version: '[3.5,)'
        recipeList:
          - dev.snowdrop.openrewrite.recipe.spring.ReplaceSpringBootApplicationWithQuarkusMainAnnotation
          - org.openrewrite.java.RemoveMethodInvocations:
              methodPattern: "org.springframework.boot.SpringApplication run(..)"
          - dev.snowdrop.openrewrite.recipe.spring.AddQuarkusRun:
              quarkusApplicationClass: TodoApplication
        gav:
          - dev.snowdrop:openrewrite-recipes:1.0.0-SNAPSHOT
