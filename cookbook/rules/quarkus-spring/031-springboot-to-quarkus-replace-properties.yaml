- category: mandatory
  customVariables: []
  description: SpringBoot to Quarkus
  effort: 1
  labels:
    - konveyor.io/source=springboot
    - konveyor.io/target=quarkus
  links: []
  message: "SpringBoot to Quarkus."
  ruleID: 031-springboot-to-quarkus-replace-properties
  when:
    condition: |
      properties.key is 'spring.datasource.*'
  order: 6
  instructions:
    ai:
      - tasks:
          - "Read the file src/main/resources/application.properties. Convert the Spring Boot properties to Quarkus equivalents: rename spring.datasource.url to %prod.quarkus.datasource.jdbc.url, spring.datasource.username to %prod.quarkus.datasource.username, spring.datasource.password to %prod.quarkus.datasource.password, spring.datasource.driver-class-name to quarkus.datasource.jdbc.driver. Add new properties: quarkus.datasource.db-kind=mysql, quarkus.hibernate-orm.schema-management.strategy=drop-and-create, quarkus.hibernate-orm.log.sql=true. Remove all remaining spring.* properties (spring.jpa.*, server.port, etc.). Write the updated file."
    manual:
      - todo: "See openrewrite instructions"
    openrewrite:
      - name: SpringBoot to Quarkus
        description: Replace the Spring properties with Quarkus equivalent
        gav:
          - dev.snowdrop.mtool:openrewrite-recipes:1.0.5-SNAPSHOT
          - org.openrewrite:rewrite-java:8.71.0
        recipeList:
          - org.openrewrite.properties.ChangePropertyKey:
              oldPropertyKey: spring.datasource.url
              newPropertyKey: '%prod.quarkus.datasource.jdbc.url'
          - org.openrewrite.properties.ChangePropertyKey:
              oldPropertyKey: spring.datasource.username
              newPropertyKey: '%prod.quarkus.datasource.username'
          - org.openrewrite.properties.ChangePropertyKey:
              oldPropertyKey: spring.datasource.password
              newPropertyKey: '%prod.quarkus.datasource.password'
          - org.openrewrite.properties.ChangePropertyKey:
              oldPropertyKey: spring.datasource.driver-class-name
              newPropertyKey: quarkus.datasource.jdbc.driver
          - org.openrewrite.properties.AddProperty:
              property: quarkus.datasource.db-kind
              value: mysql
              delimiter: =
          - org.openrewrite.properties.AddProperty:
              property: quarkus.hibernate-orm.schema-management.strategy
              value: drop-and-create
              delimiter: =
          - org.openrewrite.properties.AddProperty:
              property: quarkus.hibernate-orm.log.sql
              value: "true"
              delimiter: =
          - org.openrewrite.properties.DeleteProperty:
              propertyKey: spring.*